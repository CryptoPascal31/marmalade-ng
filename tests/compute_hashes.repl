(env-data {"disable-marmalade":true})
(load "kadena_repl_sandbox/kda-env/init.repl")

(begin-tx)
(env-data {'admin_keyset:"marmalade-ng.admin",
           'extra_policies_admin_keyset:"marmalade-ng.extra-admin",
           'lock-namespace:false})
(namespace 'kip)
(load "../pact/kip/ng-poly-fungible-v1.pact")

(use basic-guards)
(define-namespace 'marmalade-ng GUARD_SUCCESS GUARD_SUCCESS)
(namespace "marmalade-ng")
(load "../pact/policies/token-policy-ng-v1.pact")
(load "../pact/governance.pact")
(load "../pact/utils/util-policies.pact")
(load "../pact/ledger.pact")

(load "../pact/policies/policy-adjustable-royalty.pact")
(load "../pact/policies/policy-auction-sale.pact")
(load "../pact/policies/policy-blacklist.pact")
(load "../pact/policies/policy-collection.pact")
(load "../pact/policies/policy-disable-burn.pact")
(load "../pact/policies/policy-disable-sale.pact")
(load "../pact/policies/policy-disable-transfer.pact")
(load "../pact/policies/policy-dutch-auction-sale.pact")
(load "../pact/policies/policy-extra-policies.pact")
(load "../pact/policies/policy-fixed-issuance.pact")

(load "../pact/payer-manager/payer-manager-v1.pact")
(load "../pact/payer-manager/null-payer-manager.pact")
(load "../pact/policies/policy-fixed-sale.pact")

(load "../pact/policies/policy-guards.pact")
(load "../pact/policies/policy-instant-mint.pact")
(load "../pact/policies/policy-marketplace.pact")
(load "../pact/policies/policy-non-fungible.pact")
(load "../pact/policies/policy-royalty.pact")
(load "../pact/policies/policy-trusted-custody.pact")
(load "../pact/utils/std-policies.pact")
(commit-tx)

(begin-tx)
(use free.util-strings)
(let* ((get-hash (lambda (x) (if (contains "hash" x) (at 'hash x) "/")))
       (module-hash (lambda (x) (compose (describe-module) (get-hash) x)))
       (complement-str (lambda (x) (concat (make-list (- 38 (length x)) " "))))
       (format-hash (lambda (x) (format "* {}:{} {}" [x, (complement-str x), (module-hash x)]))))

    (print (join "\n" (map (format-hash)
                           (filter (starts-with* "marmalade-ng") (list-modules)))))
)
(commit-tx)
